# Changelog

## [Unreleased] - 2026-02-10

### ‚ú® Added
- **–°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î**: –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - `database/migrations/migration_manager.py` - –º–µ–Ω–µ–¥–∂–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–π
  - `database/migrations/versions/` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
  - `migrate.py` - CLI —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

- **Persistent FSM Storage**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM –≤ SQLite
  - `utils/sqlite_storage.py` - SQLite storage –¥–ª—è FSM
  - –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞

- **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å timezone**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ DST
  - `utils/datetime_utils.py` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º
  - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è datetime
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ AmbiguousTimeError –∏ NonExistentTimeError

### üîß Fixed
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ: Race Condition –≤ reschedule_booking**
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–ª–æ—Ç–æ–≤
  - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π IntegrityError
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ rowcount –ø–æ—Å–ª–µ UPDATE
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ error codes (booking_not_found, slot_taken, slot_blocked)

- **–ü—Ä–æ–±–ª–µ–º—ã —Å timezone –≤ booking_service.py**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `parse_datetime()` –≤–º–µ—Å—Ç–æ `strptime` + `localize`
  - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –Ω–∞–∏–≤–Ω—ã–µ datetime –æ–±—ä–µ–∫—Ç—ã

- **–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ _remove_job_safe()**
  - –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ scheduler
  - –ó–∞–º–µ–Ω–∞ try/except –±–ª–æ–∫–æ–≤ –Ω–∞ –µ–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥

### üìö Documentation
- –î–æ–±–∞–≤–ª–µ–Ω CHANGELOG.md
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∏ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
```bash
python main.py
```

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
python migrate.py current

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python migrate.py migrate

# –û—Ç–∫–∞—Ç–∏—Ç—å –¥–æ –≤–µ—Ä—Å–∏–∏ 1
python migrate.py rollback 1
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `database/migrations/versions/v00X_description.py`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã `upgrade()` –∏ `downgrade()`
3. –î–æ–±–∞–≤—å—Ç–µ –∏–º–ø–æ—Ä—Ç –≤ `database/migrations/versions/__init__.py`
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `main.py` –∏ `migrate.py`

## üêõ Known Issues

- SQLite storage –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É (–¥–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Redis)
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –ª–µ—Ç–Ω–µ–µ/–∑–∏–º–Ω–µ–µ –≤—Ä–µ–º—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –º–æ–≥—É—Ç —Å–¥–≤–∏–Ω—É—Ç—å—Å—è –Ω–∞ —á–∞—Å

## üõ°Ô∏è Breaking Changes

–ù–µ—Ç breaking changes. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã.
